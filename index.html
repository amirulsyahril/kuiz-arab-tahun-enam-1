<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuiz Bahasa Arab Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        .arabic-text {
            font-size: 1.5rem;
            font-weight: 500;
            direction: rtl;
            text-align: right;
        }
        .option-btn.correct {
            background-color: #22c55e;
            color: white;
            border-color: #16a34a;
        }
        .option-btn.incorrect {
            background-color: #ef4444;
            color: white;
            border-color: #dc2626;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.9;
        }
        .menu-btn {
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #374151;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            white-space: nowrap;
        }
        .menu-btn:hover {
            background-color: #e5e7eb;
        }
        .menu-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .trophy-gold { color: #ffd700; }
        .trophy-silver { color: #c0c0c0; }
        .trophy-bronze { color: #cd7f32; }
        .note-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .note-modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px; /* Wider for table */
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from {opacity: 0; transform: scale(0.95);}
            to {opacity: 1; transform: scale(1);}
        }
         /* Styles for sentence arrangement */
         .sentence-box {
            border: 2px dashed #cbd5e1;
            min-height: 50px;
            direction: rtl;
        }
        .word-bank button {
            cursor: pointer;
        }
        .word-bank button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .check-btn.correct {
            background-color: #22c55e;
        }
        .check-btn.incorrect {
            background-color: #ef4444;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800">

    <!-- Main App Container -->
    <div id="main-app-container">
        <!-- Top Navigation -->
        <header class="bg-white shadow-md w-full sticky top-0 z-10">
            <nav class="p-4 flex flex-wrap justify-center sm:justify-between items-center max-w-7xl mx-auto gap-4">
                <div class="text-2xl font-bold text-blue-600">
                    Kuiz Interaktif Bahasa Arab Tahun 6
                </div>
                <div id="menu-container" class="flex items-center space-x-2 sm:space-x-4">
                    <a href="#" class="menu-btn" data-target="home">🏠 Halaman Utama</a>
                    <a href="#" class="menu-btn" data-target="leaderboard">🏆 Papan Markah</a>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <div class="p-4 sm:p-6 md:p-8">
            <header class="text-center mb-8">
                <h1 id="main-header" class="text-3xl sm:text-4xl font-bold text-blue-600"></h1>
                <p id="main-subtitle" class="text-lg text-gray-600"></p>
                <div id="user-info" class="mt-2 text-gray-600">
                    <!-- User info displays here during final exam -->
                </div>
            </header>

            <!-- Home Screen -->
            <div id="home-container">
                 <h2 class="text-2xl font-bold text-gray-700 border-b-2 border-blue-200 pb-2 mb-6">Senarai Bahagian Latihan & Ujian</h2>
                 <div id="home-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Home section cards will be inserted here -->
                 </div>
                 <!-- Overall results removed from home, submission happens after final exam -->
            </div>
            
             <!-- Final Exam Entry Form -->
            <div id="final-exam-entry-container" style="display: none;" class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-lg mt-10">
                <h2 class="text-2xl font-bold text-blue-600 mb-6 text-center">Maklumat Ujian Akhir</h2>
                <form id="final-exam-form" class="space-y-6">
                    <p class="text-center text-gray-500">Sila masukkan butiran anda sebelum memulakan Ujian Akhir.</p>
                    <div>
                        <label for="finalFullName" class="block text-sm font-medium text-gray-700">Nama Penuh</label>
                        <input type="text" id="finalFullName" name="finalFullName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="finalSchoolName" class="block text-sm font-medium text-gray-700">Nama Sekolah</label>
                        <input type="text" id="finalSchoolName" name="finalSchoolName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Mula Ujian Akhir
                        </button>
                    </div>
                </form>
            </div>


            <!-- Quiz Screen -->
            <main id="quiz-container" class="space-y-12" style="display: none;">
                 <div id="quiz-header-actions" class="text-center mb-6">
                    <!-- "Show Note" button will be injected here -->
                 </div>
                 <div id="quiz-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Questions will be dynamically inserted here -->
                 </div>
                 <div id="section-results-container" class="mt-8 text-center">
                    <!-- Section score and finish button will appear here -->
                 </div>
            </main>
            
            <!-- Leaderboard Screen -->
            <div id="leaderboard-container" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-700 border-b-2 border-blue-200 pb-2 mb-6">Papan Markah</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                     <p class="text-sm text-gray-600 mb-4">Papan markah menunjukkan skor Ujian Akhir yang dihantar.</p>
                    <div id="leaderboard-content" class="overflow-x-auto">
                        <!-- Leaderboard table will be inserted here -->
                    </div>
                </div>
            </div>
            
            <footer class="text-center text-xs text-gray-500 mt-12 py-4 border-t border-gray-200">
                 &copy; <span id="year-main"></span> Wan Amirul Syahril | SK Bohor Baharu, Bandar Bera | <a href="mailto:g-41275961@moe-dl.edu.my?subject=Maklum%20Balas%20Kuiz%20Bahasa%20Arab" class="text-blue-600 hover:underline">Hantar Maklum Balas</a>
            </footer>
        </div>
    </div>
    
    <!-- Note Modal -->
    <div id="note-modal" class="note-modal">
        <div class="note-modal-content">
            <h2 id="note-title" class="text-2xl font-bold text-blue-600 mb-4"></h2>
            <div id="note-content" class="text-gray-700 space-y-4"></div>
            <button id="close-note-btn" class="mt-6 w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Tutup</button>
        </div>
    </div>

    <script>
        const quizData = [
             {
                section: "Bahagian 1: Pilih إِسْم إِشَارَة (Isim Isyarah) Dekat yang Betul",
                note: `
                    <p><b>Isim Isyarah (Kata Tunjuk Dekat)</b> digunakan untuk menunjukkan sesuatu yang dekat.</p>
                    <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">هَذَا</b>: Digunakan untuk objek lelaki (muzakkar). Selalunya, perkataan ini tiada <b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ة</b> di hujungnya.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">هَذِهِ</b>: Digunakan untuk objek perempuan (muannas). Selalunya, perkataan ini mempunyai <b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ة</b> di hujungnya.</li>
                    </ul>
                `,
                questions: [
                    { question: "______ فُرْشَاةُ الْأَسْنَانِ", translation: "Berus gigi", options: ["هَذِهِ", "هَذَا"], answer: "هَذِهِ" },
                    { question: "______ مَعْجُونُ الْأَسْنَانِ", translation: "Ubat gigi", options: ["هَذِهِ", "هَذَا"], answer: "هَذَا" },
                    { question: "______ صَابُونٌ", translation: "Sabun", options: ["هَذِهِ", "هَذَا"], answer: "هَذَا" },
                    { question: "______ شَامْبُو", translation: "Syampu", options: ["هَذِهِ", "هَذَا"], answer: "هَذَا" },
                    { question: "______ مِقْلَمَةُ الْأَظَافِرِ", translation: "Pengetip kuku", options: ["هَذِهِ", "هَذَا"], answer: "هَذِهِ" },
                    { question: "______ مَغْسَلَةٌ", translation: "Sinki", options: ["هَذِهِ", "هَذَا"], answer: "هَذِهِ" },
                    { question: "______ سَلَّةُ الْمُهْمَلَاتِ", translation: "Tong sampah", options: ["هَذِهِ", "هَذَا"], answer: "هَذِهِ" },
                    { question: "______ مِنْشَفَةٌ", translation: "Tuala", options: ["هَذِهِ", "هَذَا"], answer: "هَذِهِ" },
                    { question: "______ دَلْوٌ", translation: "Baldi", options: ["هَذِهِ", "هَذَا"], answer: "هَذَا" }
                ]
            },
            {
                section: "Bahagian 2: Pilih Jantina (الْمُذَكَّرُ / الْمُؤَنَّثُ) yang Betul",
                note: `
                    <p>Dalam Bahasa Arab, setiap kata nama mempunyai jantina.</p>
                     <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">الْمُذَكَّرُ</b> (Muzakkar) merujuk kepada jantina lelaki.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">الْمُؤَنَّثُ</b> (Muannas) merujuk kepada jantina perempuan.</li>
                    </ul>
                    <p class="mt-2"><b>Petua:</b> Kebanyakan perkataan Muannas berakhir dengan huruf <b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ة</b> (ta marbutah).</p>
                `,
                questions: [
                    { question: "مُضِيفَةٌ", translation: "Pramugari", options: ["الْمُؤَنَّثُ", "الْمُذَكَّرُ"], answer: "الْمُؤَنَّثُ" },
                    { question: "مُمَرِّضَةٌ", translation: "Jururawat", options: ["الْمُؤَنَّثُ", "الْمُذَكَّرُ"], answer: "الْمُؤَنَّثُ" },
                    { question: "صَحَفِيٌّ", translation: "Wartawan", options: ["الْمُؤَنَّثُ", "الْمُذَكَّرُ"], answer: "الْمُذَكَّرُ" },
                    { question: "طَبَّاخٌ", translation: "Tukang masak", options: ["الْمُؤَنَّثُ", "الْمُذَكَّرُ"], answer: "الْمُذَكَّرُ" },
                    { question: "جُنْدِيٌّ", translation: "Askar", options: ["الْمُؤَنَّثُ", "الْمُذَكَّرُ"], answer: "الْمُذَكَّرُ" },
                    { question: "إِطْفَائِيٌّ", translation: "Ahli bomba", options: ["الْمُؤَنَّثُ", "الْمُذَكَّرُ"], answer: "الْمُذَكَّرُ" },
                    { question: "طَبِيبَةٌ", translation: "Doktor", options: ["الْمُؤَنَّثُ", "الْمُذَكَّرُ"], answer: "الْمُؤَنَّثُ" },
                    { question: "مُحَاضِرَةٌ", translation: "Pensyarah", options: ["الْمُؤَنَّثُ", "الْمُذَكَّرُ"], answer: "الْمُؤَنَّثُ" }
                ]
            },
            {
                section: "Bahagian 3: Pilih إِسْم إِشَارَة (Isim Isyarah) Jauh yang Betul",
                 note: `
                    <p><b>Isim Isyarah (Kata Tunjuk Jauh)</b> digunakan untuk menunjukkan sesuatu yang jauh.</p>
                    <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ذَلِكَ</b>: Bermaksud 'itu' untuk objek lelaki (muzakkar).</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">تِلْكَ</b>: Bermaksud 'itu' untuk objek perempuan (muannas), yang selalunya berakhir dengan huruf <b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ة</b>.</li>
                    </ul>
                `,
                questions: [
                    { question: "______ حَافِلَةٌ", translation: "Bas", options: ["تِلْكَ", "ذَلِكَ"], answer: "تِلْكَ" },
                    { question: "______ سَيَّارَةٌ", translation: "Kereta", options: ["تِلْكَ", "ذَلِكَ"], answer: "تِلْكَ" },
                    { question: "______ قَارِبٌ", translation: "Bot", options: ["تِلْكَ", "ذَلِكَ"], answer: "ذَلِكَ" },
                    { question: "______ قِطَارٌ كَهْرَبَائِيٌّ", translation: "Kereta api elektrik", options: ["تِلْكَ", "ذَلِكَ"], answer: "ذَلِكَ" },
                    { question: "______ شَاحِنَةٌ", translation: "Lori", options: ["تِلْكَ", "ذَلِكَ"], answer: "تِلْكَ" },
                    { question: "______ طَائِرَةٌ", translation: "Kapal terbang", options: ["تِلْكَ", "ذَلِكَ"], answer: "تِلْكَ" },
                    { question: "______ مِرْوَحِيَّةٌ", translation: "Helikopter", options: ["تِلْكَ", "ذَلِكَ"], answer: "تِلْكَ" }
                ]
            },
            {
                section: "Bahagian 4: Pilih الضَّمِيرُ (Dhomir) yang Sesuai",
                note: `
                    <p><b>Dhomir (Kata Ganti Nama)</b> digunakan untuk menggantikan nama orang atau benda.</p>
                     <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">أَنْتَ</b>: Awak (untuk lelaki).</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">أَنْتِ</b>: Awak (untuk perempuan).</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">هُوَ</b>: Dia (untuk lelaki).</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">هِيَ</b>: Dia (untuk perempuan).</li>
                    </ul>
                    <p class="mt-2">Padankan kata ganti nama dengan jantina perkataan yang diberi.</p>
                `,
                questions: [
                    { question: "______ مَلَايُوِيٌّ", translation: "Orang Melayu", options: ["أَنْتِ", "أَنْتَ"], answer: "أَنْتَ" },
                    { question: "______ صِينِيَّةٌ", translation: "Orang Cina", options: ["أَنْتِ", "أَنْتَ"], answer: "أَنْتِ" },
                    { question: "______ هِنْدِيٌّ", translation: "Orang India", options: ["أَنْتِ", "أَنْتَ"], answer: "أَنْتَ" },
                    { question: "______ مُوَاطِنٌ أَصْلِيٌّ", translation: "Orang Asli", options: ["هِيَ", "هُوَ"], answer: "هُوَ" },
                    { question: "______ طَائِرَةٌ", translation: "Kapal terbang", options: ["هِيَ", "هُوَ"], answer: "هِيَ" }
                ]
            },
            {
                section: "Bahagian 5: Lengkapkan Ayat dengan Kata Nama yang Sesuai",
                note: `
                    <p><b>Lengkapkan ayat</b> dengan kata nama (ism) yang betul berdasarkan kata kerja (fi'il) yang diberi.</p>
                     <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">أُنَظِّفُ</b>: Saya membersihkan.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">أَغْسِلُ</b>: Saya membasuh.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">أَسْتَخْدِمُ</b>: Saya menggunakan.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">أَضَعُ</b>: Saya meletakkan.</li>
                    </ul>
                    <p class="mt-2">Pilih kata nama yang betul untuk melengkapkan ayat.</p>
                `,
                questions: [
                    { question: "أُنَظِّفُ أَسْنَانِي بِـ ______", translation: "Saya membersihkan gigi saya dengan...", options: ["فُرْشَاةِ الْأَسْنَانِ", "الصَّابُونِ"], answer: "فُرْشَاةِ الْأَسْنَانِ" },
                    { question: "أَغْسِلُ شَعْرِي بِـ ______", translation: "Saya membasuh rambut saya dengan...", options: ["الشَّامْبُو", "الْمَاءِ"], answer: "الشَّامْبُو" },
                    { question: "أَسْتَخْدِمُ ______ لِتَرْتِيبِ الشَّعْرِ", translation: "Saya menggunakan ... untuk menyusun rambut", options: ["الْمِشْطَ", "مِقْلَمَةَ الْأَظَافِرِ"], answer: "الْمِشْطَ" },
                    { question: "أُنَظِّفُ يَدَيَّ بِـ ______", translation: "Saya membersihkan tangan saya dengan...", options: ["الصَّابُونِ", "الشَّامْبُو"], answer: "الصَّابُونِ" },
                    { question: "أَغْسِلُ وَجْهِي بِـ ______", translation: "Saya membasuh muka saya dengan...", options: ["الْمَاءِ", "الصَّابُونِ"], answer: "الْمَاءِ" },
                    { question: "أَسْتَخْدِمُ ______ لِقَصِّ الْأَظَافِرِ", translation: "Saya menggunakan ... untuk memotong kuku", options: ["مِقْلَمَةَ الْأَظَافِرِ", "الْمِشْطَ"], answer: "مِقْلَمَةَ الْأَظَافِرِ" },
                    { question: "أُنَظِّفُ يَدَيَّ فِي ______", translation: "Saya membersihkan tangan saya di...", options: ["الْمَغْسَلَةِ", "الْحَمَّامِ"], answer: "الْمَغْسَلَةِ" },
                    { question: "أَضَعُ الْمِشْطَ أَمَامَ ______", translation: "Saya meletakkan sikat di hadapan...", options: ["الْمِرْآةِ", "الدُّلَابِ"], answer: "الْمِرْآةِ" }
                ]
            },
            {
                section: "Bahagian 6: Uji Kata Perbuatan (الْفِعْلُ) dengan Dhamir",
                note: `
                    <p><b>Uji Ingatan Anda!</b></p>
                    <p class="mt-2">Pilih padanan yang betul antara Kata Ganti Nama (Dhamir) dan Kata Perbuatan (Fi'il).</p>
                    <div class="overflow-x-auto mt-4">
                        <table class="min-w-full text-center border">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border p-2">Dhamir</th>
                                    <th class="border p-2 arabic-text" style="font-size:1.1rem">يُنَظِّفُ (bersih)</th>
                                    <th class="border p-2 arabic-text" style="font-size:1.1rem">يَغْسِلُ (basuh)</th>
                                    <th class="border p-2 arabic-text" style="font-size:1.1rem">يَسْتَخْدِمُ (guna)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="border p-2">Saya (أَنَا)</td>
                                    <td class="border p-2 arabic-text">أُنَظِّفُ</td>
                                    <td class="border p-2 arabic-text">أَغْسِلُ</td>
                                    <td class="border p-2 arabic-text">أَسْتَخْدِمُ</td>
                                </tr>
                                <tr>
                                    <td class="border p-2">Awak (L) (أَنْتَ)</td>
                                    <td class="border p-2 arabic-text">تُنَظِّفُ</td>
                                    <td class="border p-2 arabic-text">تَغْسِلُ</td>
                                    <td class="border p-2 arabic-text">تَسْتَخْدِمُ</td>
                                </tr>
                                 <tr>
                                    <td class="border p-2">Awak (P) (أَنْتِ)</td>
                                    <td class="border p-2 arabic-text">تُنَظِّفِينَ</td>
                                    <td class="border p-2 arabic-text">تَغْسِلِينَ</td>
                                    <td class="border p-2 arabic-text">تَسْتَخْدِمِينَ</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `,
                questions: [
                    { question: "Saya membersihkan", translation: "Terjemah ke Bahasa Arab", options: ["أُنَظِّفُ", "تُنَظِّفُ"], answer: "أُنَظِّفُ" },
                    { question: "Awak (Lelaki) menggunakan", translation: "Terjemah ke Bahasa Arab", options: ["أَسْتَخْدِمُ", "تَسْتَخْدِمُ"], answer: "تَسْتَخْدِمُ" },
                    { question: "Awak (Perempuan) membasuh", translation: "Terjemah ke Bahasa Arab", options: ["تَغْسِلُ", "تَغْسِلِينَ"], answer: "تَغْسِلِينَ" },
                    { question: "أَسْتَخْدِمُ", translation: "Terjemah ke Bahasa Melayu", options: ["Saya menggunakan", "Awak (L) menggunakan"], answer: "Saya menggunakan"},
                    { question: "تُنَظِّفِينَ", translation: "Terjemah ke Bahasa Melayu", options: ["Awak (P) membersihkan", "Saya membersihkan"], answer: "Awak (P) membersihkan" },
                    { question: "تَغْسِلُ", translation: "Terjemah ke Bahasa Melayu", options: ["Awak (L) membasuh", "Saya membasuh"], answer: "Awak (L) membasuh" }
                ]
            },
            {
                section: "Bahagian 7: Susun Perkataan Menjadi Ayat Lengkap",
                note: `
                    <p><b>Susun Semula!</b></p>
                    <p class="mt-2">Klik pada perkataan di bawah untuk menyusunnya menjadi ayat yang betul dan lengkap. Rujuk struktur ayat yang telah dipelajari.</p>
                     <p class="mt-2"><b>Contoh Struktur:</b> Kata Tunjuk + Kata Nama + Sifat / Lokasi.</p>
                `,
                type: 'arrange',
                questions: [
                    { words: ["أَحْمَرُ", "هَذَا", "لَوْنُ", "الْمِشْطِ"], answer: "هَذَا لَوْنُ الْمِشْطِ أَحْمَرُ" },
                    { words: ["الْمَغْسَلَةِ", "فِي", "يَدَيَّ", "أُنَظِّفُ"], answer: "أُنَظِّفُ يَدَيَّ فِي الْمَغْسَلَةِ" },
                    { words: ["الْمِرْآةِ", "أَمَامَ", "الْمِشْطَ", "أَضَعُ"], answer: "أَضَعُ الْمِشْطَ أَمَامَ الْمِرْآةِ" }
                ]
            },
            { // New Final Exam Section
                section: "Ujian Akhir: Uji Kefahaman Anda",
                isFinalExam: true, // Flag to identify the final exam
                note: `
                    <p><b>Selamat Menduduki Ujian Akhir!</b></p>
                    <p class="mt-2">Bahagian ini mengandungi soalan-soalan daripada semua topik yang telah dipelajari. Jawab dengan teliti.</p>
                    <p class="mt-2">Markah ujian ini akan dihantar ke papan markah.</p>
                `,
                questions: [ // Placeholder questions - replace with actual final exam questions
                    // Example Question 1 (from Section 1)
                    { question: "______ صَابُونٌ", translation: "Sabun", options: ["هَذِهِ", "هَذَا"], answer: "هَذَا" },
                     // Example Question 2 (from Section 2)
                    { question: "مُمَرِّضَةٌ", translation: "Jururawat", options: ["الْمُؤَنَّثُ", "الْمُذَكَّרُ"], answer: "الْمُؤَنَّثُ" },
                    // Example Question 3 (from Section 3)
                     { question: "______ قَارِبٌ", translation: "Bot", options: ["تِلْكَ", "ذَلِكَ"], answer: "ذَلِكَ" },
                    // Example Question 4 (from Section 4)
                    { question: "______ صِينِيَّةٌ", translation: "Orang Cina", options: ["أَنْتِ", "أَنْتَ"], answer: "أَنْتِ" },
                     // Example Question 5 (from Section 5)
                    { question: "أَغْسِلُ وَجْهِي بِـ ______", translation: "Saya membasuh muka saya dengan...", options: ["الْمَاءِ", "الصَّابُونِ"], answer: "الْمَاءِ" },
                    // Example Question 6 (from Section 6)
                     { question: "Awak (Lelaki) menggunakan", translation: "Terjemah ke Bahasa Arab", options: ["أَسْتَخْدِمُ", "تَسْتَخْدِمُ"], answer: "تَسْتَخْدِمُ" },
                    // Example Question 7 (from Section 7 - Arrange)
                    { type: 'arrange', words: ["الْمَغْسَلَةِ", "فِي", "يَدَيَّ", "أُنَظِّفُ"], answer: "أُنَظِّفُ يَدَيَّ فِي الْمَغْسَلَةِ" },

                ]
            }
        ];

        // --- Google Sheet Web App URL ---
        const GOOGLE_SHEET_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzJU8lu4aO_5fCChjdH1OseNTdTxOeb1xXXTu7u9_ph_0B2CB9OqA0tKl_oevt-yNys/exec';

        // --- Element References ---
        // Moved inside DOMContentLoaded
        let mainAppContainer, userInfo, mainHeader, mainSubtitle, homeContainer, homeGrid;
        let finalExamEntryContainer, finalExamForm, quizContainer, quizHeaderActions, quizContent;
        let sectionResultsContainer, leaderboardContainer, leaderboardContent, menuContainer;
        let noteModal, noteTitle, noteContent, closeNoteBtn;


        // --- State Variables ---
        let currentFullName = 'Pelajar'; // Default for non-final exam interaction
        let currentSchoolName = 'Sekolah'; // Default
        let finalExamFullName = ''; // Specific for final exam submission
        let finalExamSchoolName = ''; // Specific for final exam submission
        let sectionScores = {};
        let currentSectionIndex = -1;
        let currentSectionScore = 0;
        let answeredInSection = 0;
        let isFinalExamMode = false; // To track if currently in final exam

        function initializeScores() {
            quizData.forEach((_, index) => {
                 if (!quizData[index].isFinalExam) {
                      sectionScores[`section_${index}`] = null;
                 }
            });
             sectionScores['final_exam'] = null;
        }
        
        // Final Exam Form Submission
         function handleFinalExamSubmit(e) {
            e.preventDefault();
            finalExamFullName = document.getElementById('finalFullName').value;
            finalExamSchoolName = document.getElementById('finalSchoolName').value;

            if (finalExamFullName.trim() && finalExamSchoolName.trim()) {
                 currentFullName = finalExamFullName; 
                 currentSchoolName = finalExamSchoolName; 
                 
                 finalExamEntryContainer.style.display = 'none'; 
                 isFinalExamMode = true; 
                 
                 const finalExamIndex = quizData.findIndex(section => section.isFinalExam);
                 if (finalExamIndex !== -1) {
                    renderQuizForSection(finalExamIndex); 
                    quizContainer.style.display = 'block';
                 } else {
                     console.error("Final Exam section not found in quizData");
                 }
            }
        }


        function handleMenuClick(e) {
            if (e.target.matches('.menu-btn')) {
                e.preventDefault();
                const targetView = e.target.dataset.target;
                showView(targetView);
            }
        }
        
        // --- Note Modal Logic ---
        function showNote(sectionIndex) {
            const sectionData = quizData[sectionIndex];
            noteTitle.textContent = sectionData.section.split(':')[0]; 
            noteContent.innerHTML = sectionData.note;
            noteModal.style.display = 'flex';
        }
        
        function hideNote() {
            noteModal.style.display = 'none';
        }
        
       function handleCloseNoteClick() {
            hideNote();
        }
        
        function handleModalBackgroundClick(e) {
            if (e.target === noteModal) {
                hideNote();
            }
        }


        function showView(viewName) {
            homeContainer.style.display = 'none';
            quizContainer.style.display = 'none';
            leaderboardContainer.style.display = 'none';
             finalExamEntryContainer.style.display = 'none'; 
            document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
             isFinalExamMode = false; 

            if (viewName === 'home') {
                mainHeader.textContent = "Halaman Utama";
                mainSubtitle.textContent = "Pilih Latihan atau Ujian";
                homeContainer.style.display = 'block';
                document.querySelector('.menu-btn[data-target="home"]')?.classList.add('active');
                renderHomePage();
            } else if (viewName.startsWith('quiz_')) {
                const sectionIndex = parseInt(viewName.split('_')[1]);
                const sectionData = quizData[sectionIndex];

                 if (sectionData.isFinalExam) {
                     mainHeader.textContent = "Ujian Akhir";
                     mainSubtitle.textContent = "Sila Masukkan Maklumat Anda";
                     finalExamEntryContainer.style.display = 'block';
                 } else {
                    renderQuizForSection(sectionIndex);
                    quizContainer.style.display = 'block';
                 }

            } else if (viewName === 'leaderboard') {
                mainHeader.textContent = "Papan Markah";
                mainSubtitle.textContent = "Kedudukan Ujian Akhir";
                leaderboardContainer.style.display = 'block';
                document.querySelector('.menu-btn[data-target="leaderboard"]')?.classList.add('active');
                showLeaderboardFromGoogleSheets();
            }
        }

        function renderHomePage() {
            homeGrid.innerHTML = '';

            quizData.forEach((sectionData, index) => {
                 const isFinal = sectionData.isFinalExam;
                 const scoreKey = isFinal ? 'final_exam' : `section_${index}`;
                 const score = sectionScores[scoreKey];
                 const sectionTotal = sectionData.questions.length; 
                
                 const isCompleted = score !== null;

                const card = document.createElement('div');
                card.className = `p-6 rounded-lg shadow-md transition-all cursor-pointer ${
                    isFinal 
                    ? 'bg-yellow-100 border-2 border-yellow-500 hover:shadow-xl hover:scale-105' 
                    : (isCompleted ? 'bg-green-100 border-2 border-green-500' : 'bg-white hover:shadow-xl hover:scale-105')
                }`;
                card.innerHTML = `
                    <h3 class="font-bold text-lg ${isFinal ? 'text-yellow-700' : 'text-blue-600'}">${sectionData.section.split(':')[0]}</h3>
                    <p class="text-gray-700 mt-1">${sectionData.section.split(': ')[1]}</p>
                    <div class="mt-4 font-bold text-lg ${isCompleted ? (isFinal ? 'text-yellow-800' : 'text-green-700') : 'text-gray-400'}">
                         ${isFinal ? (isCompleted ? `Markah: ${score} / ${sectionTotal}` : 'Belum Diambil') : (isCompleted ? `Markah: ${score} / ${sectionTotal}` : 'Belum Selesai')}
                    </div>
                `;
                card.onclick = () => showView(`quiz_${index}`);
                homeGrid.appendChild(card);
            });
        }

        function renderQuizForSection(sectionIndex) {
            currentSectionIndex = sectionIndex;
            currentSectionScore = 0;
            answeredInSection = 0;
            const sectionData = quizData[sectionIndex];
            
            mainHeader.textContent = sectionData.section.split(':')[0];
            mainSubtitle.textContent = sectionData.section.split(': ')[1];
            
            // Ensure userInfo is available before accessing innerHTML
            if (userInfo) {
                 userInfo.innerHTML = isFinalExamMode ? `<p class="font-semibold">${currentFullName}</p><p class="text-sm">${currentSchoolName}</p>` : '';
            }


            quizHeaderActions.innerHTML = `
                <button id="show-note-btn" class="bg-blue-100 text-blue-700 font-semibold py-2 px-4 rounded-lg hover:bg-blue-200 transition-colors">
                    💡 Lihat Nota Pembelajaran
                </button>
            `;
            document.getElementById('show-note-btn').onclick = () => showNote(sectionIndex);

            
            quizContent.innerHTML = '';
            sectionResultsContainer.innerHTML = '';
            quizContent.classList.add('md:grid-cols-2'); 

            sectionData.questions.forEach((q, qIndex) => {
                 if (q.type === 'arrange' || sectionData.type === 'arrange') { 
                    quizContent.classList.remove('md:grid-cols-2'); 
                    const questionCard = document.createElement('div');
                    questionCard.className = 'bg-white p-6 rounded-lg shadow-md md:col-span-2'; 
                    
                    const sentenceBox = document.createElement('div');
                    sentenceBox.className = 'sentence-box p-3 rounded-md mb-4 flex items-center justify-end flex-wrap-reverse gap-2 arabic-text text-xl';
                    
                    const wordBank = document.createElement('div');
                    wordBank.className = 'word-bank flex flex-wrap justify-center gap-3 p-3 border-t';

                    const wordsToShuffle = q.words || [];
                    const shuffledWords = [...wordsToShuffle].sort(() => Math.random() - 0.5);


                    shuffledWords.forEach(word => {
                        const wordBtn = document.createElement('button');
                        wordBtn.textContent = word;
                        wordBtn.className = 'arabic-text bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-5 border border-gray-400 rounded-lg shadow transition-colors duration-300';
                        wordBtn.onclick = () => {
                            sentenceBox.appendChild(wordBtn);
                            wordBtn.onclick = null; 
                        };
                        wordBank.appendChild(wordBtn);
                    });
                    
                    const actionsContainer = document.createElement('div');
                    actionsContainer.className = 'flex justify-center gap-4 mt-4';
                    
                    const checkBtn = document.createElement('button');
                    checkBtn.textContent = 'Semak';
                    checkBtn.className = 'check-btn bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-600';
                    checkBtn.onclick = () => {
                        const arrangedSentence = Array.from(sentenceBox.children).map(btn => btn.textContent).join(' ');
                        if (arrangedSentence === q.answer) {
                            checkBtn.classList.add('correct');
                            currentSectionScore++;
                        } else {
                            checkBtn.classList.add('incorrect');
                        }
                        wordBank.querySelectorAll('button').forEach(btn => btn.disabled = true);
                        checkBtn.disabled = true;
                        resetBtn.disabled = true;
                        answeredInSection++;
                        if (answeredInSection === sectionData.questions.length) {
                             showSectionResults();
                        }
                    };

                    const resetBtn = document.createElement('button');
                    resetBtn.textContent = 'Susun Semula';
                    resetBtn.className = 'bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-gray-600';
                    resetBtn.onclick = () => {
                         sentenceBox.innerHTML = '';
                         wordBank.innerHTML = '';
                         shuffledWords.forEach(word => {
                            const wordBtn = document.createElement('button');
                            wordBtn.textContent = word;
                            wordBtn.className = 'arabic-text bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-5 border border-gray-400 rounded-lg shadow transition-colors duration-300';
                            wordBtn.onclick = () => {
                                sentenceBox.appendChild(wordBtn);
                                wordBtn.onclick = null;
                            };
                            wordBank.appendChild(wordBtn);
                        });
                    };

                    actionsContainer.appendChild(resetBtn);
                    actionsContainer.appendChild(checkBtn);
                    
                    questionCard.appendChild(sentenceBox);
                    questionCard.appendChild(wordBank);
                    questionCard.appendChild(actionsContainer);
                    quizContent.appendChild(questionCard);
                } else { 
                    const questionCard = document.createElement('div');
                    questionCard.className = 'bg-white p-6 rounded-lg shadow-md flex flex-col items-center';
                    const questionText = document.createElement('p');
                    const isArabicQuestion = /[\u0600-\u06FF]/.test(q.question);
                    questionText.className = isArabicQuestion ? 'arabic-text text-center text-2xl' : 'text-center text-2xl font-semibold';
                    questionText.textContent = q.question;
                    
                    const translationText = document.createElement('p');
                    translationText.className = 'text-center text-gray-500 mb-5 text-md italic';
                    translationText.textContent = `(${q.translation})`;

                    const optionsContainer = document.createElement('div');
                    optionsContainer.className = 'flex justify-center items-center gap-4 mt-auto';
                    
                    q.options.forEach(option => {
                        const button = document.createElement('button');
                        const isArabicOption = /[\u0600-\u06FF]/.test(option);
                        button.textContent = option;
                        button.className = isArabicOption 
                            ? 'option-btn arabic-text bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-5 border border-gray-400 rounded-lg shadow transition-colors duration-300'
                            : 'option-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-5 border border-gray-400 rounded-lg shadow transition-colors duration-300';
                        button.addEventListener('click', () => handleAnswerClick(button, option, q, optionsContainer));
                        optionsContainer.appendChild(button);
                    });
                    
                    questionCard.appendChild(questionText);
                    questionCard.appendChild(translationText);
                    questionCard.appendChild(optionsContainer);
                    quizContent.appendChild(questionCard);
                }
            });

        }
        
       function showSectionResults() {
             const totalQuestionsInSection = quizData[currentSectionIndex].questions.length;
             const sectionData = quizData[currentSectionIndex];
             const scoreKey = sectionData.isFinalExam ? 'final_exam' : `section_${currentSectionIndex}`;
             
             sectionScores[scoreKey] = currentSectionScore; 

             let resultsHtml = `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold mb-2">${sectionData.isFinalExam ? 'Ujian Akhir Selesai!' : 'Bahagian Selesai!'}</h3>
                    <p>Markah Anda: <span class="font-bold text-blue-600">${currentSectionScore}</span> / ${totalQuestionsInSection}</p>`;

             if (sectionData.isFinalExam) {
                 resultsHtml += `
                    <button id="submit-final-exam-btn" class="mt-4 bg-green-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-green-700">
                        Hantar Markah Ujian Akhir
                    </button>`;
             } else {
                 resultsHtml += `
                    <button id="finish-section-btn" class="mt-4 bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-blue-700">
                        Kembali ke Halaman Utama
                    </button>`;
             }
             resultsHtml += `</div>`;
             
             sectionResultsContainer.innerHTML = resultsHtml;

             if (sectionData.isFinalExam) {
                 document.getElementById('submit-final-exam-btn').onclick = saveScoreToGoogleSheets;
             } else {
                 document.getElementById('finish-section-btn').onclick = () => showView('home');
             }
             isFinalExamMode = false; 
        }


        function handleAnswerClick(button, option, question, optionsContainer) {
            optionsContainer.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            if (option === question.answer) {
                button.classList.add('correct');
                currentSectionScore++;
            } else {
                button.classList.add('incorrect');
                optionsContainer.querySelectorAll('.option-btn').forEach(btn => {
                    if (btn.textContent === question.answer) btn.classList.add('correct');
                });
            }
            answeredInSection++;
            
            const totalQuestionsInSection = quizData[currentSectionIndex].questions.length;
            if (answeredInSection === totalQuestionsInSection) {
                showSectionResults();
            }
        }
        
        async function saveScoreToGoogleSheets() {
             if (!isFinalExamMode) {
                 console.warn("Attempted to save score outside of final exam mode.");
                 return; 
             }
            
            if (GOOGLE_SHEET_WEB_APP_URL === 'PASTE_YOUR_WEB_APP_URL_HERE') {
                sectionResultsContainer.innerHTML += `<p class="text-red-500 mt-4">Ralat: Sila konfigurasikan URL Google Sheets Web App terlebih dahulu.</p>`;
                return;
            }
            const submitBtn = document.getElementById('submit-final-exam-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Menyimpan...';

             const finalExamScore = sectionScores['final_exam']; 
             const finalExamTotalQuestions = quizData.find(s => s.isFinalExam)?.questions.length || 0;


            const data = {
                fullName: finalExamFullName, 
                schoolName: finalExamSchoolName, 
                scores: { final_exam: finalExamScore }, 
                totalScore: finalExamScore, 
                totalQuestions: finalExamTotalQuestions 
            };

            try {
                 await fetch(GOOGLE_SHEET_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                    redirect: 'follow' 
                });
                
                sectionResultsContainer.innerHTML = `
                     <div class="bg-white p-6 rounded-lg shadow-md">
                         <h3 class="text-xl font-bold mb-2">Ujian Akhir Selesai!</h3>
                         <p>Markah Anda: <span class="font-bold text-blue-600">${currentSectionScore}</span> / ${finalExamTotalQuestions}</p>
                        <p class="text-green-600 font-semibold my-4 text-xl">Markah anda telah berjaya dihantar!</p>
                        <button id="view-leaderboard-btn" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-blue-700 mr-2">Lihat Papan Markah</button>
                         <button id="back-home-btn" class="bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-gray-600">Kembali ke Halaman Utama</button>
                     </div>
                `;
                document.getElementById('view-leaderboard-btn').onclick = () => showView('leaderboard');
                document.getElementById('back-home-btn').onclick = () => showView('home');


            } catch (error) {
                console.error("Error saving score to Google Sheets:", error);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Hantar Markah Ujian Akhir';
                sectionResultsContainer.innerHTML += `<p class="text-red-500 text-sm mt-2">Gagal menghantar markah. Sila periksa konsol untuk ralat.</p>`;
            }
        }

        async function showLeaderboardFromGoogleSheets() {
             if (GOOGLE_SHEET_WEB_APP_URL === 'PASTE_YOUR_WEB_APP_URL_HERE') {
                leaderboardContent.innerHTML = `<p class="text-red-500">Papan markah tidak dapat dimuatkan. Sila konfigurasikan URL Google Sheets Web App.</p>`;
                return;
            }
            leaderboardContent.innerHTML = `<p>Memuatkan markah...</p>`;
            try {
                const response = await fetch(GOOGLE_SHEET_WEB_APP_URL); 
                const scores = await response.json();

                if (scores.length === 0) {
                    leaderboardContent.innerHTML = `<p>Tiada markah Ujian Akhir lagi. Jadilah yang pertama!</p>`;
                    return;
                }
                
                 const finalExamTotalQuestions = quizData.find(s => s.isFinalExam)?.questions.length || 0; 
                
                let tableHtml = `
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ked.</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sekolah</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Markah Ujian Akhir</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                `;

                scores.forEach((entry, index) => {
                    let rankIcon = index + 1;
                    if (index === 0) rankIcon = '🏆';
                    if (index === 1) rankIcon = '🥈';
                    if (index === 2) rankIcon = '🥉';

                    tableHtml += `
                        <tr>
                            <td class="px-4 py-4 whitespace-nowrap text-lg font-bold">${rankIcon}</td>
                            <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">${entry.fullName}</td>
                            <td class="px-4 py-4 whitespace-nowrap text-gray-500">${entry.schoolName}</td>
                            <td class="px-4 py-4 whitespace-nowrap font-bold text-blue-600 text-center">${entry.totalScore} / ${entry.totalQuestions || finalExamTotalQuestions}</td> 
                        </tr>
                    `; 
                });
                tableHtml += `</tbody></table>`;
                leaderboardContent.innerHTML = tableHtml;

            } catch (error) {
                console.error("Error fetching scores from Google Sheets:", error);
                leaderboardContent.innerHTML = `<p class="text-red-500">Tidak dapat memuatkan papan markah. Sila pastikan URL dan kebenaran adalah betul.</p>`;
            }
        }
        
        function startQuizApp() {
            initializeScores();
            showView('home'); 
        }

        document.addEventListener('DOMContentLoaded', () => {
             // Define element references after DOM is loaded
             mainAppContainer = document.getElementById('main-app-container');
             userInfo = document.getElementById('user-info'); 
             mainHeader = document.getElementById('main-header');
             mainSubtitle = document.getElementById('main-subtitle');
             homeContainer = document.getElementById('home-container');
             homeGrid = document.getElementById('home-grid');
             finalExamEntryContainer = document.getElementById('final-exam-entry-container');
             finalExamForm = document.getElementById('final-exam-form');
             quizContainer = document.getElementById('quiz-container');
             quizHeaderActions = document.getElementById('quiz-header-actions');
             quizContent = document.getElementById('quiz-content');
             sectionResultsContainer = document.getElementById('section-results-container');
             leaderboardContainer = document.getElementById('leaderboard-container');
             leaderboardContent = document.getElementById('leaderboard-content');
             menuContainer = document.getElementById('menu-container');
             noteModal = document.getElementById('note-modal');
             noteTitle = document.getElementById('note-title');
             noteContent = document.getElementById('note-content');
             closeNoteBtn = document.getElementById('close-note-btn');

             // Add event listeners
             finalExamForm.addEventListener('submit', handleFinalExamSubmit);
             menuContainer.addEventListener('click', handleMenuClick);
             closeNoteBtn.addEventListener('click', handleCloseNoteClick);
             noteModal.addEventListener('click', handleModalBackgroundClick);

             // Start the app
             mainAppContainer.style.display = 'block'; 
             document.getElementById('year-main').textContent = new Date().getFullYear();
             startQuizApp(); 
        });
    </script>
</body>
</html>

