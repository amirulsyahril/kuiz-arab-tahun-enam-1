<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuiz Bahasa Arab Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        .arabic-text {
            font-size: 1.5rem;
            font-weight: 500;
            direction: rtl;
            text-align: right;
        }
        .option-btn.correct {
            background-color: #22c55e;
            color: white;
            border-color: #16a34a;
        }
        .option-btn.incorrect {
            background-color: #ef4444;
            color: white;
            border-color: #dc2626;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.9;
        }
        .menu-btn {
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #374151;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            white-space: nowrap;
        }
        .menu-btn:hover {
            background-color: #e5e7eb;
        }
        .menu-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .trophy-gold { color: #ffd700; }
        .trophy-silver { color: #c0c0c0; }
        .trophy-bronze { color: #cd7f32; }
        .note-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .note-modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px; /* Wider for table */
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from {opacity: 0; transform: scale(0.95);}
            to {opacity: 1; transform: scale(1);}
        }
         /* Styles for sentence arrangement */
         .sentence-box {
            border: 2px dashed #cbd5e1;
            min-height: 50px;
            direction: rtl;
        }
        .word-bank button {
            cursor: pointer;
        }
        .word-bank button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .check-btn.correct {
            background-color: #22c55e;
            color: white;
            border-color: #16a34a;
        }
        .check-btn.incorrect {
            background-color: #ef4444;
            color: white;
            border-color: #dc2626;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800">

    <!-- Main App Container -->
    <div id="main-app-container">
        <!-- Top Navigation -->
        <header class="bg-white shadow-md w-full sticky top-0 z-10">
            <nav class="p-4 flex flex-wrap justify-center sm:justify-between items-center max-w-7xl mx-auto gap-4">
                <div class="text-2xl font-bold text-blue-600">
                    Kuiz Interaktif Bahasa Arab Tahun 6
                </div>
                <div id="menu-container" class="flex items-center space-x-2 sm:space-x-4">
                    <a href="#" class="menu-btn" data-target="home">üè† Halaman Utama</a>
                    <a href="#" class="menu-btn" data-target="leaderboard">üèÜ Papan Markah</a>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <div class="p-4 sm:p-6 md:p-8">
            <header class="text-center mb-8">
                <h1 id="main-header" class="text-3xl sm:text-4xl font-bold text-blue-600"></h1>
                <p id="main-subtitle" class="text-lg text-gray-600"></p>
                <div id="user-info" class="mt-2 text-gray-600">
                    <!-- User info displays here during final exam -->
                </div>
            </header>

            <!-- Home Screen -->
            <div id="home-container">
                 <h2 class="text-2xl font-bold text-gray-700 border-b-2 border-blue-200 pb-2 mb-6">Senarai Bahagian Latihan & Ujian</h2>
                 <div id="home-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Home section cards will be inserted here -->
                 </div>
                 <!-- Overall results removed from home, submission happens after final exam -->
            </div>
            
             <!-- Final Exam Entry Form -->
            <div id="final-exam-entry-container" style="display: none;" class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-lg mt-10">
                <h2 class="text-2xl font-bold text-blue-600 mb-6 text-center">Maklumat Ujian Akhir</h2>
                <form id="final-exam-form" class="space-y-6">
                    <p class="text-center text-gray-500">Sila masukkan butiran anda sebelum memulakan Ujian Akhir.</p>
                    <div>
                        <label for="finalFullName" class="block text-sm font-medium text-gray-700">Nama Penuh</label>
                        <input type="text" id="finalFullName" name="finalFullName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="finalSchoolName" class="block text-sm font-medium text-gray-700">Nama Sekolah</label>
                        <input type="text" id="finalSchoolName" name="finalSchoolName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Mula Ujian Akhir
                        </button>
                    </div>
                </form>
            </div>


            <!-- Quiz Screen -->
            <main id="quiz-container" class="space-y-12" style="display: none;">
                 <div id="quiz-header-actions" class="text-center mb-6">
                    <!-- "Show Note" button will be injected here -->
                 </div>
                 <div id="quiz-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Questions will be dynamically inserted here -->
                 </div>
                 <div id="section-results-container" class="mt-8 text-center">
                    <!-- Section score and finish button will appear here -->
                 </div>
            </main>
            
            <!-- Leaderboard Screen -->
            <div id="leaderboard-container" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-700 border-b-2 border-blue-200 pb-2 mb-6">Papan Markah</h2>
                <div class="bg-white p-6 rounded-lg shadow-md">
                     <p class="text-sm text-gray-600 mb-4">Papan markah menunjukkan skor Ujian Akhir yang dihantar.</p>
                    <div id="leaderboard-content" class="overflow-x-auto">
                        <!-- Leaderboard table will be inserted here -->
                    </div>
                </div>
            </div>
            
            <footer class="text-center text-xs text-gray-500 mt-12 py-4 border-t border-gray-200">
                 &copy; <span id="year-main"></span> Wan Amirul Syahril | SK Bohor Baharu, Bandar Bera | <a href="mailto:g-41275961@moe-dl.edu.my?subject=Maklum%20Balas%20Kuiz%20Bahasa%20Arab" class="text-blue-600 hover:underline">Hantar Maklum Balas</a>
            </footer>
        </div>
    </div>
    
    <!-- Note Modal -->
    <div id="note-modal" class="note-modal">
        <div class="note-modal-content">
            <h2 id="note-title" class="text-2xl font-bold text-blue-600 mb-4"></h2>
            <div id="note-content" class="text-gray-700 space-y-4"></div>
            <button id="close-note-btn" class="mt-6 w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Tutup</button>
        </div>
    </div>

    <script>
        const quizData = [
             {
                section: "Bahagian 1: Pilih ÿ•Ÿêÿ≥ŸíŸÖ ÿ•Ÿêÿ¥Ÿéÿßÿ±Ÿéÿ© (Isim Isyarah) Dekat yang Betul",
                note: `
                    <p><b>Isim Isyarah (Kata Tunjuk Dekat)</b> digunakan untuk menunjukkan sesuatu yang dekat.</p>
                    <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ŸáŸéÿ∞Ÿéÿß</b>: Digunakan untuk objek lelaki (muzakkar). Selalunya, perkataan ini tiada <b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ©</b> di hujungnya.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ŸáŸéÿ∞ŸêŸáŸê</b>: Digunakan untuk objek perempuan (muannas). Selalunya, perkataan ini mempunyai <b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ©</b> di hujungnya.</li>
                    </ul>
                `,
                questions: [
                    { question: "______ ŸÅŸèÿ±Ÿíÿ¥Ÿéÿßÿ©Ÿè ÿßŸÑŸíÿ£Ÿéÿ≥ŸíŸÜŸéÿßŸÜŸê", translation: "Berus gigi", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞ŸêŸáŸê" },
                    { question: "______ ŸÖŸéÿπŸíÿ¨ŸèŸàŸÜŸè ÿßŸÑŸíÿ£Ÿéÿ≥ŸíŸÜŸéÿßŸÜŸê", translation: "Ubat gigi", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞Ÿéÿß" },
                    { question: "______ ÿµŸéÿßÿ®ŸèŸàŸÜŸå", translation: "Sabun", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞Ÿéÿß" },
                    { question: "______ ÿ¥ŸéÿßŸÖŸíÿ®ŸèŸà", translation: "Syampu", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞Ÿéÿß" },
                    { question: "______ ŸÖŸêŸÇŸíŸÑŸéŸÖŸéÿ©Ÿè ÿßŸÑŸíÿ£Ÿéÿ∏ŸéÿßŸÅŸêÿ±Ÿê", translation: "Pengetip kuku", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞ŸêŸáŸê" },
                    { question: "______ ŸÖŸéÿ∫Ÿíÿ≥ŸéŸÑŸéÿ©Ÿå", translation: "Sinki", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞ŸêŸáŸê" },
                    { question: "______ ÿ≥ŸéŸÑŸéŸëÿ©Ÿè ÿßŸÑŸíŸÖŸèŸáŸíŸÖŸéŸÑŸéÿßÿ™Ÿê", translation: "Tong sampah", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞ŸêŸáŸê" },
                    { question: "______ ŸÖŸêŸÜŸíÿ¥ŸéŸÅŸéÿ©Ÿå", translation: "Tuala", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞ŸêŸáŸê" },
                    { question: "______ ÿØŸéŸÑŸíŸàŸå", translation: "Baldi", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞Ÿéÿß" }
                ]
            },
            {
                section: "Bahagian 2: Pilih Jantina (ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè / ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè) yang Betul",
                note: `
                    <p>Dalam Bahasa Arab, setiap kata nama mempunyai jantina.</p>
                     <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè</b> (Muzakkar) merujuk kepada jantina lelaki.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè</b> (Muannas) merujuk kepada jantina perempuan.</li>
                    </ul>
                    <p class="mt-2"><b>Petua:</b> Kebanyakan perkataan Muannas berakhir dengan huruf <b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ©</b> (ta marbutah).</p>
                `,
                questions: [
                    { question: "ŸÖŸèÿ∂ŸêŸäŸÅŸéÿ©Ÿå", translation: "Pramugari", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè" },
                    { question: "ŸÖŸèŸÖŸéÿ±ŸêŸëÿ∂Ÿéÿ©Ÿå", translation: "Jururawat", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè" },
                    { question: "ÿµŸéÿ≠ŸéŸÅŸêŸäŸåŸë", translation: "Wartawan", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè" },
                    { question: "ÿ∑Ÿéÿ®ŸéŸëÿßÿÆŸå", translation: "Tukang masak", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè" },
                    { question: "ÿ¨ŸèŸÜŸíÿØŸêŸäŸåŸë", translation: "Askar", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè" },
                    { question: "ÿ•Ÿêÿ∑ŸíŸÅŸéÿßÿ¶ŸêŸäŸåŸë", translation: "Ahli bomba", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè" },
                    { question: "ÿ∑Ÿéÿ®ŸêŸäÿ®Ÿéÿ©Ÿå", translation: "Doktor", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè" },
                    { question: "ŸÖŸèÿ≠Ÿéÿßÿ∂Ÿêÿ±Ÿéÿ©Ÿå", translation: "Pensyarah", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè" }
                ]
            },
            {
                section: "Bahagian 3: Pilih ÿ•Ÿêÿ≥ŸíŸÖ ÿ•Ÿêÿ¥Ÿéÿßÿ±Ÿéÿ© (Isim Isyarah) Jauh yang Betul",
                 note: `
                    <p><b>Isim Isyarah (Kata Tunjuk Jauh)</b> digunakan untuk menunjukkan sesuatu yang jauh.</p>
                    <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ∞ŸéŸÑŸêŸÉŸé</b>: Bermaksud 'itu' untuk objek lelaki (muzakkar).</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ™ŸêŸÑŸíŸÉŸé</b>: Bermaksud 'itu' untuk objek perempuan (muannas), yang selalunya berakhir dengan huruf <b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ©</b>.</li>
                    </ul>
                `,
                questions: [
                    { question: "______ ÿ≠ŸéÿßŸÅŸêŸÑŸéÿ©Ÿå", translation: "Bas", options: ["ÿ™ŸêŸÑŸíŸÉŸé", "ÿ∞ŸéŸÑŸêŸÉŸé"], answer: "ÿ™ŸêŸÑŸíŸÉŸé" },
                    { question: "______ ÿ≥ŸéŸäŸéŸëÿßÿ±Ÿéÿ©Ÿå", translation: "Kereta", options: ["ÿ™ŸêŸÑŸíŸÉŸé", "ÿ∞ŸéŸÑŸêŸÉŸé"], answer: "ÿ™ŸêŸÑŸíŸÉŸé" },
                    { question: "______ ŸÇŸéÿßÿ±Ÿêÿ®Ÿå", translation: "Bot", options: ["ÿ™ŸêŸÑŸíŸÉŸé", "ÿ∞ŸéŸÑŸêŸÉŸé"], answer: "ÿ∞ŸéŸÑŸêŸÉŸé" },
                    { question: "______ ŸÇŸêÿ∑Ÿéÿßÿ±Ÿå ŸÉŸéŸáŸíÿ±Ÿéÿ®Ÿéÿßÿ¶ŸêŸäŸåŸë", translation: "Kereta api elektrik", options: ["ÿ™ŸêŸÑŸíŸÉŸé", "ÿ∞ŸéŸÑŸêŸÉŸé"], answer: "ÿ∞ŸéŸÑŸêŸÉŸé" },
                    { question: "______ ÿ¥Ÿéÿßÿ≠ŸêŸÜŸéÿ©Ÿå", translation: "Lori", options: ["ÿ™ŸêŸÑŸíŸÉŸé", "ÿ∞ŸéŸÑŸêŸÉŸé"], answer: "ÿ™ŸêŸÑŸíŸÉŸé" },
                    { question: "______ ÿ∑Ÿéÿßÿ¶Ÿêÿ±Ÿéÿ©Ÿå", translation: "Kapal terbang", options: ["ÿ™ŸêŸÑŸíŸÉŸé", "ÿ∞ŸéŸÑŸêŸÉŸé"], answer: "ÿ™ŸêŸÑŸíŸÉŸé" },
                    { question: "______ ŸÖŸêÿ±ŸíŸàŸéÿ≠ŸêŸäŸéŸëÿ©Ÿå", translation: "Helikopter", options: ["ÿ™ŸêŸÑŸíŸÉŸé", "ÿ∞ŸéŸÑŸêŸÉŸé"], answer: "ÿ™ŸêŸÑŸíŸÉŸé" }
                ]
            },
            {
                section: "Bahagian 4: Pilih ÿßŸÑÿ∂ŸéŸëŸÖŸêŸäÿ±Ÿè (Dhomir) yang Sesuai",
                note: `
                    <p><b>Dhomir (Kata Ganti Nama)</b> digunakan untuk menggantikan nama orang atau benda.</p>
                     <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ£ŸéŸÜŸíÿ™Ÿé</b>: Awak (untuk lelaki).</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ£ŸéŸÜŸíÿ™Ÿê</b>: Awak (untuk perempuan).</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ŸáŸèŸàŸé</b>: Dia (untuk lelaki).</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ŸáŸêŸäŸé</b>: Dia (untuk perempuan).</li>
                    </ul>
                    <p class="mt-2">Padankan kata ganti nama dengan jantina perkataan yang diberi.</p>
                `,
                questions: [
                    { question: "______ ŸÖŸéŸÑŸéÿßŸäŸèŸàŸêŸäŸåŸë", translation: "Orang Melayu", options: ["ÿ£ŸéŸÜŸíÿ™Ÿê", "ÿ£ŸéŸÜŸíÿ™Ÿé"], answer: "ÿ£ŸéŸÜŸíÿ™Ÿé" },
                    { question: "______ ÿµŸêŸäŸÜŸêŸäŸéŸëÿ©Ÿå", translation: "Orang Cina", options: ["ÿ£ŸéŸÜŸíÿ™Ÿê", "ÿ£ŸéŸÜŸíÿ™Ÿé"], answer: "ÿ£ŸéŸÜŸíÿ™Ÿê" },
                    { question: "______ ŸáŸêŸÜŸíÿØŸêŸäŸåŸë", translation: "Orang India", options: ["ÿ£ŸéŸÜŸíÿ™Ÿê", "ÿ£ŸéŸÜŸíÿ™Ÿé"], answer: "ÿ£ŸéŸÜŸíÿ™Ÿé" },
                    { question: "______ ŸÖŸèŸàŸéÿßÿ∑ŸêŸÜŸå ÿ£ŸéÿµŸíŸÑŸêŸäŸåŸë", translation: "Orang Asli", options: ["ŸáŸêŸäŸé", "ŸáŸèŸàŸé"], answer: "ŸáŸèŸàŸé" },
                    { question: "______ ÿ∑Ÿéÿßÿ¶Ÿêÿ±Ÿéÿ©Ÿå", translation: "Kapal terbang", options: ["ŸáŸêŸäŸé", "ŸáŸèŸàŸé"], answer: "ŸáŸêŸäŸé" }
                ]
            },
            {
                section: "Bahagian 5: Lengkapkan Ayat dengan Kata Nama yang Sesuai",
                note: `
                    <p><b>Lengkapkan ayat</b> dengan kata nama (ism) yang betul berdasarkan kata kerja (fi'il) yang diberi.</p>
                     <ul class="list-disc list-inside mt-2">
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè</b>: Saya membersihkan.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ£Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè</b>: Saya membasuh.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ£Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè</b>: Saya menggunakan.</li>
                        <li><b class="arabic-text" style="font-size: 1.2rem; display: inline-block;">ÿ£Ÿéÿ∂ŸéÿπŸè</b>: Saya meletakkan.</li>
                    </ul>
                    <p class="mt-2">Pilih kata nama yang betul untuk melengkapkan ayat.</p>
                `,
                questions: [
                    { question: "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè ÿ£Ÿéÿ≥ŸíŸÜŸéÿßŸÜŸêŸä ÿ®ŸêŸÄ ______", translation: "Saya membersihkan gigi saya dengan...", options: ["ŸÅŸèÿ±Ÿíÿ¥Ÿéÿßÿ©Ÿê ÿßŸÑŸíÿ£Ÿéÿ≥ŸíŸÜŸéÿßŸÜŸê", "ÿßŸÑÿµŸéŸëÿßÿ®ŸèŸàŸÜŸê"], answer: "ŸÅŸèÿ±Ÿíÿ¥Ÿéÿßÿ©Ÿê ÿßŸÑŸíÿ£Ÿéÿ≥ŸíŸÜŸéÿßŸÜŸê" },
                    { question: "ÿ£Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè ÿ¥ŸéÿπŸíÿ±ŸêŸä ÿ®ŸêŸÄ ______", translation: "Saya membasuh rambut saya dengan...", options: ["ÿßŸÑÿ¥ŸéŸëÿßŸÖŸíÿ®ŸèŸà", "ÿßŸÑŸíŸÖŸéÿßÿ°Ÿê"], answer: "ÿßŸÑÿ¥ŸéŸëÿßŸÖŸíÿ®ŸèŸà" },
                    { question: "ÿ£Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè ______ ŸÑŸêÿ™Ÿéÿ±Ÿíÿ™ŸêŸäÿ®Ÿê ÿßŸÑÿ¥ŸéŸëÿπŸíÿ±Ÿê", translation: "Saya menggunakan ... untuk menyusun rambut", options: ["ÿßŸÑŸíŸÖŸêÿ¥Ÿíÿ∑Ÿé", "ŸÖŸêŸÇŸíŸÑŸéŸÖŸéÿ©Ÿé ÿßŸÑŸíÿ£Ÿéÿ∏ŸéÿßŸÅŸêÿ±Ÿê"], answer: "ÿßŸÑŸíŸÖŸêÿ¥Ÿíÿ∑Ÿé" },
                    { question: "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè ŸäŸéÿØŸéŸäŸéŸë ÿ®ŸêŸÄ ______", translation: "Saya membersihkan tangan saya dengan...", options: ["ÿßŸÑÿµŸéŸëÿßÿ®ŸèŸàŸÜŸê", "ÿßŸÑÿ¥ŸéŸëÿßŸÖŸíÿ®ŸèŸà"], answer: "ÿßŸÑÿµŸéŸëÿßÿ®ŸèONŸê" },
                    { question: "ÿ£Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè ŸàŸéÿ¨ŸíŸáŸêŸä ÿ®ŸêŸÄ ______", translation: "Saya membasuh muka saya dengan...", options: ["ÿßŸÑŸíŸÖŸéÿßÿ°Ÿê", "ÿßŸÑÿµŸéŸëÿßÿ®ŸèŸàŸÜŸê"], answer: "ÿßŸÑŸíŸÖŸéÿßÿ°Ÿê" },
                    { question: "ÿ£Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè ______ ŸÑŸêŸÇŸéÿµŸêŸë ÿßŸÑŸíÿ£Ÿéÿ∏ŸéÿßŸÅŸêÿ±Ÿê", translation: "Saya menggunakan ... untuk memotong kuku", options: ["ŸÖŸêŸÇŸíŸÑŸéŸÖŸéÿ©Ÿé ÿßŸÑŸíÿ£Ÿéÿ∏ŸéÿßŸÅŸêÿ±Ÿê", "ÿßŸÑŸíŸÖŸêÿ¥Ÿíÿ∑Ÿé"], answer: "ŸÖŸêŸÇŸíŸÑŸéŸÖŸéÿ©Ÿé ÿßŸÑŸíÿ£Ÿéÿ∏ŸéÿßŸÅŸêÿ±Ÿê" },
                    { question: "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè ŸäŸéÿØŸéŸäŸéŸë ŸÅŸêŸä ______", translation: "Saya membersihkan tangan saya di...", options: ["ÿßŸÑŸíŸÖŸéÿ∫Ÿíÿ≥ŸéŸÑŸéÿ©Ÿê", "ÿßŸÑŸíÿ≠ŸéŸÖŸéŸëÿßŸÖŸê"], answer: "ÿßŸÑŸíŸÖŸéÿ∫Ÿíÿ≥ŸéŸÑŸéÿ©Ÿê" },
                    { question: "ÿ£Ÿéÿ∂ŸéÿπŸè ÿßŸÑŸíŸÖŸêÿ¥Ÿíÿ∑Ÿé ÿ£ŸéŸÖŸéÿßŸÖŸé ______", translation: "Saya meletakkan sikat di hadapan...", options: ["ÿßŸÑŸíŸÖŸêÿ±Ÿíÿ¢ÿ©Ÿê", "ÿßŸÑÿØŸèŸëŸÑŸéÿßÿ®Ÿê"], answer: "ÿßŸÑŸíŸÖŸêÿ±Ÿíÿ¢ÿ©Ÿê" }
                ]
            },
            {
                section: "Bahagian 6: Uji Kata Perbuatan (ÿßŸÑŸíŸÅŸêÿπŸíŸÑŸè) dengan Dhamir",
                note: `
                    <p><b>Uji Ingatan Anda!</b></p>
                    <p class="mt-2">Pilih padanan yang betul antara Kata Ganti Nama (Dhamir) dan Kata Perbuatan (Fi'il).</p>
                    <div class="overflow-x-auto mt-4">
                        <table class="min-w-full text-center border">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border p-2">Dhamir</th>
                                    <th class="border p-2 arabic-text" style="font-size:1.1rem">ŸäŸèŸÜŸéÿ∏ŸêŸëŸÅŸè (bersih)</th>
                                    <th class="border p-2 arabic-text" style="font-size:1.1rem">ŸäŸéÿ∫Ÿíÿ≥ŸêŸÑŸè (basuh)</th>
                                    <th class="border p-2 arabic-text" style="font-size:1.1rem">ŸäŸéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè (guna)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="border p-2">Saya (ÿ£ŸéŸÜŸéÿß)</td>
                                    <td class="border p-2 arabic-text">ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè</td>
                                    <td class="border p-2 arabic-text">ÿ£Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè</td>
                                    <td class="border p-2 arabic-text">ÿ£Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè</td>
                                </tr>
                                <tr>
                                    <td class="border p-2">Awak (L) (ÿ£ŸéŸÜŸíÿ™Ÿé)</td>
                                    <td class="border p-2 arabic-text">ÿ™ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè</td>
                                    <td class="border p-2 arabic-text">ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè</td>
                                    <td class="border p-2 arabic-text">ÿ™Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè</td>
                                </tr>
                                 <tr>
                                    <td class="border p-2">Awak (P) (ÿ£ŸéŸÜŸíÿ™Ÿê)</td>
                                    <td class="border p-2 arabic-text">ÿ™ŸèŸÜŸéÿ∏ŸêŸëŸÅŸêŸäŸÜŸé</td>
                                    <td class="border p-2 arabic-text">ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸêŸäŸÜŸé</td>
                                    <td class="border p-2 arabic-text">ÿ™Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸêŸäŸÜŸé</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `,
                questions: [
                    { question: "Saya membersihkan", translation: "Terjemah ke Bahasa Arab", options: ["ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè", "ÿ™ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè"], answer: "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè" },
                    { question: "Awak (Lelaki) menggunakan", translation: "Terjemah ke Bahasa Arab", options: ["ÿ£Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè", "ÿ™Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè"], answer: "ÿ™Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè" },
                    { question: "Awak (Perempuan) membasuh", translation: "Terjemah ke Bahasa Arab", options: ["ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè", "ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸêŸäŸÜŸé"], answer: "ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸêŸäŸÜŸé" },
                    { question: "ÿ£Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè", translation: "Terjemah ke Bahasa Melayu", options: ["Saya menggunakan", "Awak (L) menggunakan"], answer: "Saya menggunakan"},
                    { question: "ÿ™ŸèŸÜŸéÿ∏ŸêŸëŸÅŸêŸäŸÜŸé", translation: "Terjemah ke Bahasa Melayu", options: ["Awak (P) membersihkan", "Saya membersihkan"], answer: "Awak (P) membersihkan" },
                    { question: "ÿ™Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè", translation: "Terjemah ke Bahasa Melayu", options: ["Awak (L) membasuh", "Saya membasuh"], answer: "Awak (L) membasuh" }
                ]
            },
            {
                section: "Bahagian 7: Susun Perkataan Menjadi Ayat Lengkap",
                note: `
                    <p><b>Susun Semula!</b></p>
                    <p class="mt-2">Klik pada perkataan di bawah untuk menyusunnya menjadi ayat yang betul dan lengkap. Rujuk struktur ayat yang telah dipelajari.</p>
                     <p class="mt-2"><b>Contoh Struktur:</b> Kata Tunjuk + Kata Nama + Sifat / Lokasi.</p>
                `,
                type: 'arrange',
                questions: [
                    { words: ["ÿ£Ÿéÿ≠ŸíŸÖŸéÿ±Ÿè", "ŸáŸéÿ∞Ÿéÿß", "ŸÑŸéŸàŸíŸÜŸè", "ÿßŸÑŸíŸÖŸêÿ¥Ÿíÿ∑Ÿê"], answer: "ŸáŸéÿ∞Ÿéÿß ŸÑŸéŸàŸíŸÜŸè ÿßŸÑŸíŸÖŸêÿ¥Ÿíÿ∑Ÿê ÿ£Ÿéÿ≠ŸíŸÖŸéÿ±Ÿè" },
                    { words: ["ÿßŸÑŸíŸÖŸéÿ∫Ÿíÿ≥ŸéŸÑŸéÿ©Ÿê", "ŸÅŸêŸä", "ŸäŸéÿØŸéŸäŸéŸë", "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè"], answer: "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè ŸäŸéÿØŸéŸäŸéŸë ŸÅŸêŸä ÿßŸÑŸíŸÖŸéÿ∫Ÿíÿ≥ŸéŸÑŸéÿ©Ÿê" },
                    { words: ["ÿßŸÑŸíŸÖŸêÿ±Ÿíÿ¢ÿ©Ÿê", "ÿ£ŸéŸÖŸéÿßŸÖŸé", "ÿßŸÑŸíŸÖŸêÿ¥Ÿíÿ∑Ÿé", "ÿ£Ÿéÿ∂ŸéÿπŸè"], answer: "ÿ£Ÿéÿ∂ŸéÿπŸè ÿßŸÑŸíŸÖŸêÿ¥Ÿíÿ∑Ÿé ÿ£ŸéŸÖŸéÿßŸÖŸé ÿßŸÑŸíŸÖŸêÿ±Ÿíÿ¢ÿ©Ÿê" }
                ]
            },
            { // New Final Exam Section
                section: "Ujian Akhir: Uji Kefahaman Anda",
                isFinalExam: true, // Flag to identify the final exam
                note: `
                    <p><b>Selamat Menduduki Ujian Akhir!</b></p>
                    <p class="mt-2">Bahagian ini mengandungi soalan-soalan daripada semua topik yang telah dipelajari. Jawab dengan teliti.</p>
                    <p class="mt-2">Markah ujian ini akan dihantar ke papan markah.</p>
                `,
                questions: [ // Placeholder questions - replace with actual final exam questions
                    // Example Question 1 (from Section 1)
                    { question: "______ ÿµŸéÿßÿ®ŸèŸàŸÜŸå", translation: "Sabun", options: ["ŸáŸéÿ∞ŸêŸáŸê", "ŸáŸéÿ∞Ÿéÿß"], answer: "ŸáŸéÿ∞Ÿéÿß" },
                     // Example Question 2 (from Section 2)
                    { question: "ŸÖŸèŸÖŸéÿ±ŸêŸëÿ∂Ÿéÿ©Ÿå", translation: "Jururawat", options: ["ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè", "ÿßŸÑŸíŸÖŸèÿ∞ŸéŸÉŸéŸëÿ±Ÿè"], answer: "ÿßŸÑŸíŸÖŸèÿ§ŸéŸÜŸéŸëÿ´Ÿè" },
                    // Example Question 3 (from Section 3)
                     { question: "______ ŸÇŸéÿßÿ±Ÿêÿ®Ÿå", translation: "Bot", options: ["ÿ™ŸêŸÑŸíŸÉŸé", "ÿ∞ŸéŸÑŸêŸÉŸé"], answer: "ÿ∞ŸéŸÑŸêŸÉŸé" },
                    // Example Question 4 (from Section 4)
                    { question: "______ ÿµŸêŸäŸÜŸêŸäŸéŸëÿ©Ÿå", translation: "Orang Cina", options: ["ÿ£ŸéŸÜŸíÿ™Ÿê", "ÿ£ŸéŸÜŸíÿ™Ÿé"], answer: "ÿ£ŸéŸÜŸíÿ™Ÿê" },
                     // Example Question 5 (from Section 5)
                    { question: "ÿ£Ÿéÿ∫Ÿíÿ≥ŸêŸÑŸè ŸàŸéÿ¨ŸíŸáŸêŸä ÿ®ŸêŸÄ ______", translation: "Saya membasuh muka saya dengan...", options: ["ÿßŸÑŸíŸÖŸéÿßÿ°Ÿê", "ÿßŸÑÿµŸéŸëÿßÿ®ŸèŸàŸÜŸê"], answer: "ÿßŸÑŸíŸÖŸéÿßÿ°Ÿê" },
                    // Example Question 6 (from Section 6)
                     { question: "Awak (Lelaki) menggunakan", translation: "Terjemah ke Bahasa Arab", options: ["ÿ£Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè", "ÿ™Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè"], answer: "ÿ™Ÿéÿ≥Ÿíÿ™ŸéÿÆŸíÿØŸêŸÖŸè" },
                    // Example Question 7 (from Section 7 - Arrange)
                    { type: 'arrange', words: ["ÿßŸÑŸíŸÖŸéÿ∫Ÿíÿ≥ŸéŸÑŸéÿ©Ÿê", "ŸÅŸêŸä", "ŸäŸéÿØŸéŸäŸéŸë", "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè"], answer: "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè ŸäŸéÿØŸéŸäŸéŸë ŸÅŸêŸä ÿßŸÑŸíŸÖŸéÿ∫Ÿíÿ≥ŸéŸÑŸéÿ©Ÿê" },

                ]
            }
        ];

        // --- Google Sheet Web App URL ---
        // !! PENTING !!
        // Gantikan URL ini dengan URL Web App Google Sheets anda yang telah di-deploy.
        // 1. Pergi ke Google Apps Script.
        // 2. Klik "Deploy" -> "New deployment".
        // 3. Pilih "Web app".
        // 4. Tetapkan "Execute as" kepada "Me".
        // 5. Tetapkan "Who has access" kepada "Anyone".
        // 6. Klik "Deploy".
        // 7. Salin "Web app URL" dan tampal di bawah.
        const GOOGLE_SHEET_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzJU8lu4aO_5fCChjdH1OseNTdTxOeb1xXXTu7u9_ph_0B2CB9OqA0tKl_oevt-yNys/exec'; // GANTIKAN DENGAN URL WEB APP ANDA

        // --- Element References ---
        let mainAppContainer, userInfo, mainHeader, mainSubtitle, homeContainer, homeGrid;
        let finalExamEntryContainer, finalExamForm, quizContainer, quizHeaderActions, quizContent;
        let sectionResultsContainer, leaderboardContainer, leaderboardContent, menuContainer;
        let noteModal, noteTitle, noteContent, closeNoteBtn;


        // --- State Variables ---
        let currentFullName = 'Pelajar'; // Default for non-final exam interaction
        let currentSchoolName = 'Sekolah'; // Default
        let finalExamFullName = ''; // Specific for final exam submission
        let finalExamSchoolName = ''; // Specific for final exam submission
        let sectionScores = {};
        let currentSectionIndex = -1;
        let currentSectionScore = 0;
        let answeredInSection = 0;
        let isFinalExamMode = false; // To track if currently in final exam

        function initializeScores() {
            quizData.forEach((_, index) => {
                 if (!quizData[index].isFinalExam) {
                      sectionScores[`section_${index}`] = null;
                 }
            });
             sectionScores['final_exam'] = null;
        }
        
        // Final Exam Form Submission
         function handleFinalExamSubmit(e) {
            e.preventDefault();
            finalExamFullName = document.getElementById('finalFullName').value;
            finalExamSchoolName = document.getElementById('finalSchoolName').value;

            if (finalExamFullName.trim() && finalExamSchoolName.trim()) {
                 currentFullName = finalExamFullName; 
                 currentSchoolName = finalExamSchoolName; 
                 
                 finalExamEntryContainer.style.display = 'none'; 
                 isFinalExamMode = true; 
                 
                 const finalExamIndex = quizData.findIndex(section => section.isFinalExam);
                 if (finalExamIndex !== -1) {
                    renderQuizForSection(finalExamIndex); 
                    quizContainer.style.display = 'block';
                 } else {
                     console.error("Final Exam section not found in quizData");
                 }
            }
        }


        function handleMenuClick(e) {
            if (e.target.matches('.menu-btn')) {
                e.preventDefault();
                const targetView = e.target.dataset.target;
                showView(targetView);
            }
        }
        
        // --- Note Modal Logic ---
        function showNote(sectionIndex) {
            const sectionData = quizData[sectionIndex];
            noteTitle.textContent = sectionData.section.split(':')[0]; 
            noteContent.innerHTML = sectionData.note;
            noteModal.style.display = 'flex';
        }
        
        function hideNote() {
            noteModal.style.display = 'none';
        }
        
       function handleCloseNoteClick() {
            hideNote();
        }
        
        function handleModalBackgroundClick(e) {
            if (e.target === noteModal) {
                hideNote();
            }
        }


        function showView(viewName) {
            homeContainer.style.display = 'none';
            quizContainer.style.display = 'none';
            leaderboardContainer.style.display = 'none';
             finalExamEntryContainer.style.display = 'none'; 
            document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
             
            // Reset final exam mode if not navigating to the quiz from the entry form
            if (!viewName.startsWith('quiz_')) {
                 isFinalExamMode = false; 
                 userInfo.textContent = '';
            }

            if (viewName === 'home') {
                mainHeader.textContent = "Halaman Utama";
                mainSubtitle.textContent = "Pilih Latihan atau Ujian";
                homeContainer.style.display = 'block';
                document.querySelector('.menu-btn[data-target="home"]')?.classList.add('active');
                renderHomePage();
            } else if (viewName.startsWith('quiz_')) {
                const sectionIndex = parseInt(viewName.split('_')[1]);
                const sectionData = quizData[sectionIndex];

                 if (sectionData.isFinalExam && !isFinalExamMode) { // Check if it's final exam AND we haven't entered details
                     mainHeader.textContent = "Ujian Akhir";
                     mainSubtitle.textContent = "Sila Masukkan Maklumat Anda";
                     finalExamEntryContainer.style.display = 'block';
                 } else {
                    // This handles normal sections OR the final exam after details are entered
                    renderQuizForSection(sectionIndex);
                    quizContainer.style.display = 'block';
                 }

            } else if (viewName === 'leaderboard') {
                mainHeader.textContent = "Papan Markah";
                mainSubtitle.textContent = "Kedudukan Ujian Akhir";
                leaderboardContainer.style.display = 'block';
                document.querySelector('.menu-btn[data-target="leaderboard"]')?.classList.add('active');
                showLeaderboardFromGoogleSheets();
            }
        }

        function renderHomePage() {
            homeGrid.innerHTML = '';

            quizData.forEach((sectionData, index) => {
                 const isFinal = sectionData.isFinalExam;
                 const scoreKey = isFinal ? 'final_exam' : `section_${index}`;
                 const score = sectionScores[scoreKey];
                 const sectionTotal = sectionData.questions.length; 
                
                 const isCompleted = score !== null;

                const card = document.createElement('div');
                card.className = `p-6 rounded-lg shadow-md transition-all cursor-pointer ${
                    isFinal 
                    ? 'bg-yellow-100 border-2 border-yellow-500 hover:shadow-xl hover:scale-105' 
                    : (isCompleted ? 'bg-green-100 border-2 border-green-500' : 'bg-white hover:shadow-xl hover:scale-105')
                }`;
                card.innerHTML = `
                    <h3 class="font-bold text-lg ${isFinal ? 'text-yellow-700' : 'text-blue-600'}">${sectionData.section.split(':')[0]}</h3>
                    <p class="text-gray-700 mt-1">${sectionData.section.split(': ')[1] || (isFinal ? 'Uji kefahaman semua topik' : 'Latihan topik')}</p>
                    <div class="mt-4 font-bold text-lg ${isCompleted ? (isFinal ? 'text-yellow-800' : 'text-green-700') : (isFinal ? 'text-yellow-700' : 'text-gray-700')}">
                        ${isCompleted ? `Skor: ${score}/${sectionTotal} (${Math.round((score / sectionTotal) * 100)}%)` : (isFinal ? 'Mula Ujian Akhir' : 'Mula Latihan')}
                    </div>
                `;
                card.addEventListener('click', () => {
                    showView(`quiz_${index}`);
                });
                homeGrid.appendChild(card);
            });
        }

        function renderQuizForSection(sectionIndex) {
            currentSectionIndex = sectionIndex;
            const sectionData = quizData[currentSectionIndex];
            
            // Set headers based on mode
            if (isFinalExamMode) {
                mainHeader.textContent = sectionData.section;
                mainSubtitle.textContent = `Pelajar: ${finalExamFullName} | Sekolah: ${finalExamSchoolName}`;
                userInfo.textContent = `Pelajar: ${finalExamFullName} | Sekolah: ${finalExamSchoolName}`;
            } else {
                mainHeader.textContent = sectionData.section.split(':')[0];
                mainSubtitle.textContent = sectionData.section.split(': ')[1] || "Jawab soalan berikut";
                userInfo.textContent = '';
            }

            quizContent.innerHTML = '';
            sectionResultsContainer.innerHTML = '';
            quizHeaderActions.innerHTML = '';
            currentSectionScore = 0;
            answeredInSection = 0;

            // Add "Show Note" button
            const noteButton = document.createElement('button');
            noteButton.textContent = 'üìñ Tunjuk Nota';
            noteButton.className = 'bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition-all';
            noteButton.onclick = () => showNote(sectionIndex);
            quizHeaderActions.appendChild(noteButton);

            // Render questions
            sectionData.questions.forEach((question, index) => {
                renderQuestion(question, index, sectionIndex);
            });
        }

        function renderQuestion(question, index, sectionIndex) {
            const questionCard = document.createElement('div');
            questionCard.className = 'bg-white p-6 rounded-lg shadow-md w-full';
            
            if (question.type === 'arrange') {
                renderArrangeQuestion(questionCard, question, index);
            } else {
                renderMultipleChoiceQuestion(questionCard, question, index);
            }
            quizContent.appendChild(questionCard);
        }
        
        function renderMultipleChoiceQuestion(questionCard, question, index) {
             questionCard.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <span class="text-sm font-semibold text-blue-600">Soalan ${index + 1}</span>
                </div>
                <p class="arabic-text mb-2">${question.question}</p>
                <p class="text-gray-500 text-sm mb-6">${question.translation}</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4" id="options-${index}">
                    ${question.options.map((option, i) => `
                        <button 
                            class="option-btn arabic-text w-full p-4 border-2 border-gray-300 rounded-lg text-lg text-gray-800 hover:bg-blue-100 hover:border-blue-400 transition-all"
                            data-question-index="${index}"
                            data-option="${option}"
                        >
                            ${option}
                        </button>
                    `).join('')}
                </div>
            `;
            
            const optionButtons = questionCard.querySelectorAll(`#options-${index} button`);
            optionButtons.forEach(button => {
                button.addEventListener('click', handleOptionClick);
            });
        }
        
        function renderArrangeQuestion(questionCard, question, index) {
            // Shuffle words for the word bank
            const shuffledWords = [...question.words].sort(() => Math.random() - 0.5);

            questionCard.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <span class="text-sm font-semibold text-blue-600">Soalan ${index + 1} (Susun Ayat)</span>
                </div>
                <p class="text-gray-500 text-sm mb-4">Susun perkataan berikut menjadi ayat yang betul.</p>
                
                <!-- Target Sentence Box -->
                <div id="sentence-box-${index}" class="sentence-box p-4 rounded-lg bg-gray-50 mb-4 flex flex-wrap-reverse gap-2 justify-end">
                    <!-- Words will be added here -->
                </div>

                <!-- Word Bank -->
                <div id="word-bank-${index}" class="word-bank p-4 rounded-lg bg-gray-100 flex flex-wrap-reverse gap-2 justify-end">
                    ${shuffledWords.map((word, i) => `
                        <button 
                            class="p-2 bg-white border border-gray-300 rounded-md shadow-sm arabic-text text-lg hover:bg-blue-100"
                            data-word="${word}"
                            data-question-index="${index}"
                        >
                            ${word}
                        </button>
                    `).join('')}
                </div>
                
                <!-- Action Buttons -->
                <div class="mt-6 flex gap-4">
                    <button id="check-btn-${index}" data-question-index="${index}" class="check-btn w-full py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">Semak</button>
                    <button id="reset-btn-${index}" data-question-index="${index}" class="w-full py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg shadow-md hover:bg-gray-600">Set Semula</button>
                </div>
                <p id="feedback-${index}" class="text-center mt-4 font-semibold"></p>
            `;

            const wordBank = questionCard.querySelector(`#word-bank-${index}`);
            const sentenceBox = questionCard.querySelector(`#sentence-box-${index}`);
            const checkBtn = questionCard.querySelector(`#check-btn-${index}`);
            const resetBtn = questionCard.querySelector(`#reset-btn-${index}`);
            const feedback = questionCard.querySelector(`#feedback-${index}`);
            
            // Click to move from bank to sentence
            wordBank.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    sentenceBox.appendChild(e.target);
                }
            });

            // Click to move from sentence to bank
            sentenceBox.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    wordBank.appendChild(e.target);
                }
            });
            
            // Reset button logic
            resetBtn.addEventListener('click', () => {
                // Move all buttons from sentenceBox back to wordBank
                Array.from(sentenceBox.children).forEach(button => {
                    wordBank.appendChild(button);
                });
                feedback.textContent = '';
                checkBtn.disabled = false;
                checkBtn.classList.remove('correct', 'incorrect');
            });
            
            // Check button logic
            checkBtn.addEventListener('click', (e) => handleArrangeCheck(e, question));
        }

        function handleOptionClick(e) {
            const selectedButton = e.currentTarget;
            const questionIndex = selectedButton.dataset.questionIndex;
            const selectedOption = selectedButton.dataset.option;
            const question = quizData[currentSectionIndex].questions[questionIndex];

            const isCorrect = (selectedOption === question.answer);
            
            if (isCorrect) {
                selectedButton.classList.add('correct');
                currentSectionScore++;
            } else {
                selectedButton.classList.add('incorrect');
                // Highlight the correct answer
                const correctButton = document.querySelector(`#options-${questionIndex} button[data-option="${question.answer}"]`);
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
            }

            // Disable all buttons for this question
            const allButtons = document.querySelectorAll(`#options-${questionIndex} button`);
            allButtons.forEach(btn => {
                btn.disabled = true;
            });

            answeredInSection++;
            checkSectionCompletion();
        }
        
        function handleArrangeCheck(e, question) {
            const checkBtn = e.currentTarget;
            const questionIndex = checkBtn.dataset.questionIndex;
            const sentenceBox = document.getElementById(`sentence-box-${questionIndex}`);
            const feedback = document.getElementById(`feedback-${questionIndex}`);
            
            // Get words from sentence box
            const arrangedWords = Array.from(sentenceBox.children).map(btn => btn.dataset.word);
            const arrangedSentence = arrangedWords.join(' ');
            
            const isCorrect = (arrangedSentence === question.answer);

            if (isCorrect) {
                checkBtn.classList.add('correct');
                feedback.textContent = 'Betul!';
                feedback.className = 'text-center mt-4 font-semibold text-green-600';
                currentSectionScore++;
            } else {
                checkBtn.classList.add('incorrect');
                feedback.textContent = `Salah. Jawapan: ${question.answer}`;
                feedback.className = 'text-center mt-4 font-semibold text-red-600 arabic-text';
            }
            
             // Disable buttons
            checkBtn.disabled = true;
            document.querySelectorAll(`#word-bank-${questionIndex} button, #sentence-box-${questionIndex} button`).forEach(btn => {
                 btn.disabled = true;
                 btn.style.cursor = 'not-allowed';
            });
            document.getElementById(`reset-btn-${questionIndex}`).disabled = true;

            answeredInSection++;
            checkSectionCompletion();
        }

        function checkSectionCompletion() {
            const totalQuestions = quizData[currentSectionIndex].questions.length;
            if (answeredInSection === totalQuestions) {
                showSectionResults();
            }
        }

        function showSectionResults() {
            const sectionData = quizData[currentSectionIndex];
            const totalQuestions = sectionData.questions.length;
            const percentage = Math.round((currentSectionScore / totalQuestions) * 100);

            // Save score
            const scoreKey = isFinalExamMode ? 'final_exam' : `section_${currentSectionIndex}`;
            sectionScores[scoreKey] = currentSectionScore;

            sectionResultsContainer.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg mx-auto text-center">
                    <h2 class="text-3xl font-bold ${percentage >= 50 ? 'text-green-600' : 'text-red-600'}">
                        ${isFinalExamMode ? 'Ujian Selesai!' : 'Latihan Selesai!'}
                    </h2>
                    <p class="text-xl text-gray-700 mt-4">Skor Anda:</p>
                    <p class="text-6xl font-extrabold text-blue-600 my-4">${currentSectionScore} / ${totalQuestions}</p>
                    <p class="text-4xl font-bold text-blue-600">${percentage}%</p>
                    <button id="finish-section-btn" class="mt-8 w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-all text-lg">
                        ${isFinalExamMode ? 'Hantar Markah & Kembali' : 'Kembali ke Halaman Utama'}
                    </button>
                </div>
            `;
            
            document.getElementById('finish-section-btn').addEventListener('click', finishSection);
        }

        async function finishSection() {
            if (isFinalExamMode) {
                await submitFinalExamScoreToGoogleSheets();
            }
            isFinalExamMode = false; // Reset mode
            currentFullName = 'Pelajar'; // Reset to default
            currentSchoolName = 'Sekolah'; // Reset to default
            finalExamFullName = '';
            finalExamSchoolName = '';
            userInfo.textContent = ''; // Clear user info from header
            showView('home');
        }

        async function submitFinalExamScoreToGoogleSheets() {
             const button = document.getElementById('finish-section-btn');
             button.disabled = true;
             button.textContent = 'Menghantar...';

             const webAppUrl = GOOGLE_SHEET_WEB_APP_URL; 
             
             if (!webAppUrl || webAppUrl === 'PASTE_YOUR_WEB_APP_URL_HERE') {
                 console.error("Sila masukkan Google Sheet Web App URL anda dalam kod.");
                 // Menggunakan tetingkap modal tersuai dan bukannya alert()
                 showCustomAlert("Ralat: URL Google Sheet Web App belum ditetapkan. Markah tidak dapat dihantar.");
                 button.textContent = 'Ralat! Semak Konsol';
                 button.disabled = false;
                 return;
             }
             
             const totalQuestions = quizData[currentSectionIndex].questions.length;
             const percentage = Math.round((currentSectionScore / totalQuestions) * 100);
             
             // Menggunakan URLSearchParams untuk POST data
             const formData = new URLSearchParams();
             formData.append('fullName', finalExamFullName);
             formData.append('schoolName', finalExamSchoolName);
             formData.append('score', currentSectionScore);
             formData.append('total', totalQuestions);
             formData.append('percentage', percentage);
             formData.append('timestamp', new Date().toISOString());

            try {
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    body: formData,
                    mode: 'no-cors' // Google Apps Script sering mengembalikan ralat CORS walaupun berjaya, jadi 'no-cors' digunakan.
                });
                 
                // Oleh kerana 'no-cors' digunakan, kita tidak boleh membaca status respons.
                // Kita anggap berjaya jika 'fetch' tidak membuang ralat.
                console.log("Score submission initiated (no-cors).");
                showCustomAlert("Markah anda telah berjaya dihantar!");

            } catch (error) {
                console.error('Error submitting score:', error);
                showCustomAlert('Terdapat ralat semasa menghantar markah anda. Sila cuba lagi.');
            } finally {
                // Walaupun butang akan disembunyikan oleh showView('home'),
                // adalah amalan baik untuk mengaktifkannya semula.
                button.disabled = false; 
            }
        }
        
        async function showLeaderboardFromGoogleSheets() {
            leaderboardContent.innerHTML = '<p class="text-center text-gray-600">Memuatkan papan markah...</p>';
            
            const webAppUrl = GOOGLE_SHEET_WEB_APP_URL;

             if (!webAppUrl || webAppUrl === 'PASTE_YOUR_WEB_APP_URL_HERE') {
                 console.error("Sila masukkan Google Sheet Web App URL anda dalam kod.");
                 leaderboardContent.innerHTML = '<p class="text-center text-red-600 font-semibold">Ralat: URL Google Sheet Web App belum ditetapkan.</p>';
                 return;
             }
             
            try {
                // Tambah parameter untuk memberitahu skrip kita mahu GET data
                const response = await fetch(`${webAppUrl}?action=getLeaderboard`);
                if (!response.ok) {
                    throw new Error(`Ralat Rangkaian: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                     throw new Error(data.error);
                }

                if (!data.leaderboard || data.leaderboard.length === 0) {
                    leaderboardContent.innerHTML = '<p class="text-center text-gray-600">Tiada markah dihantar lagi.</p>';
                    return;
                }

                // Susun mengikut peratusan (menurun), kemudian tarikh (menaik)
                const sortedData = data.leaderboard.sort((a, b) => {
                    if (b.percentage !== a.percentage) {
                        return b.percentage - a.percentage;
                    }
                    return new Date(a.timestamp) - new Date(b.timestamp);
                });

                let tableHtml = `
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sekolah</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Skor</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                `;
                
                sortedData.forEach((row, index) => {
                     let trophy = '';
                     if (index === 0) trophy = '<span class="trophy-gold">ü•á</span>';
                     else if (index === 1) trophy = '<span class="trophy-silver">ü•à</span>';
                     else if (index === 2) trophy = '<span class="trophy-bronze">ü•â</span>';
                
                    tableHtml += `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1} ${trophy}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">${row.fullName}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row.schoolName}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600">${row.percentage}%</td>
                        </tr>
                    `;
                });

                tableHtml += '</tbody></table>';
                leaderboardContent.innerHTML = tableHtml;

            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                leaderboardContent.innerHTML = `<p class="text-center text-red-600 font-semibold">Tidak dapat memuatkan papan markah: ${error.message}</p>`;
            }
        }

        // Fungsi untuk menggantikan alert()
        function showCustomAlert(message) {
            // Anda boleh membina modal yang lebih canggih di sini
            // Untuk sekarang, kita akan gunakan console.log dan modal nota jika boleh
            console.warn("CUSTOM ALERT:", message);
            
            // Re-use note modal for alerts
            noteTitle.textContent = 'Makluman'; 
            noteContent.innerHTML = `<p>${message}</p>`;
            noteModal.style.display = 'flex';
        }
        
        
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Assign element references
            mainAppContainer = document.getElementById('main-app-container');
            userInfo = document.getElementById('user-info');
            mainHeader = document.getElementById('main-header');
            mainSubtitle = document.getElementById('main-subtitle');
            homeContainer = document.getElementById('home-container');
            homeGrid = document.getElementById('home-grid');
            finalExamEntryContainer = document.getElementById('final-exam-entry-container');
            finalExamForm = document.getElementById('final-exam-form');
            quizContainer = document.getElementById('quiz-container');
            quizHeaderActions = document.getElementById('quiz-header-actions');
            quizContent = document.getElementById('quiz-content');
            sectionResultsContainer = document.getElementById('section-results-container');
            leaderboardContainer = document.getElementById('leaderboard-container');
            leaderboardContent = document.getElementById('leaderboard-content');
            menuContainer = document.getElementById('menu-container');
            
            noteModal = document.getElementById('note-modal');
            noteTitle = document.getElementById('note-title');
            noteContent = document.getElementById('note-content');
            closeNoteBtn = document.getElementById('close-note-btn');

             // Set Year
            document.getElementById('year-main').textContent = new Date().getFullYear();
            
            // Initialize
            initializeScores();
            
            // Add Event Listeners
            menuContainer.addEventListener('click', handleMenuClick);
            finalExamForm.addEventListener('submit', handleFinalExamSubmit);
            closeNoteBtn.addEventListener('click', handleCloseNoteClick);
            noteModal.addEventListener('click', handleModalBackgroundClick);
            
            // Initial View
            showView('home');
        });

    </script>
</body>
</html>


